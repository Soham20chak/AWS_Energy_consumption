---codes
CREATE EXTERNAL SCHEMA ENERGY_CONSUMPTION
FROM KINESIS
IAM_ROLE 'arn:aws:iam::896334692798:role/redshift-kinesis-role';


CREATE MATERIALIZED VIEW ENERGY AS
    SELECT
    partition_key
    FROM ENERGY_CONSUMPTION."energy_data_stream";

REFRESH MATERIALIZED VIEW ENERGY;
select * from ENERGY


REFRESH MATERIALIZED VIEW ENERGY;
-- Calculate total energy consumption per location
SELECT location, SUM(energy_consumption) AS total_energy_consumption
FROM energy_data
GROUP BY location;

REFRESH MATERIALIZED VIEW ENERGY;
-- Calculate correlation between energy consumption and temperature
SELECT CORR(energy_consumption, temperature) AS correlation
FROM energy_data;

REFRESH MATERIALIZED VIEW ENERGY;
-- Visualize energy consumption trends over time
SELECT DATE_TRUNC('day', timestamp) AS date, AVG(energy_consumption) AS avg_energy_consumption
FROM energy_data
GROUP BY DATE_TRUNC('day', timestamp)
ORDER BY date;

REFRESH MATERIALIZED VIEW ENERGY;
-- Calculate average energy consumption per location
SELECT location,
       AVG(energy_consumption) AS avg_energy_consumption
FROM energy_data
GROUP BY location
ORDER BY avg_energy_consumption DESC;

REFRESH MATERIALIZED VIEW ENERGY;
-- Identify abnormal energy consumption events (e.g., outliers)
SELECT location, timestamp, energy_consumption
FROM energy_data
WHERE energy_consumption > (SELECT AVG(energy_consumption) + 2 * STDDEV(energy_consumption) FROM energy_data)
ORDER BY energy_consumption DESC;




